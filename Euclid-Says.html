<html>
    <head>
        <title>Euclid Says - You Discover Math</title>
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <meta charset="utf-8"/>
        <script src="https://www.geogebra.org/apps/deployggb.js"></script>
        <link rel="icon" type="image/x-icon" href="Favicon.png">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
        <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
        <style>
            .switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
            transform: scale(0.705882353) translateY(-100%);
            }

            .switch input { 
            opacity: 0;
            width: 0;
            height: 0;
            }

            .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            -webkit-transition: .4s;
            transition: .4s;
            }

            .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            -webkit-transition: .4s;
            transition: .4s;
            }

            input:checked + .slider {
            background-color: #2196F3;
            }

            input:focus + .slider {
            box-shadow: 0 0 1px #2196F3;
            }

            input:checked + .slider:before {
            -webkit-transform: translateX(26px);
            -ms-transform: translateX(26px);
            transform: translateX(26px);
            }

            /* Rounded sliders */
            .slider.round {
            border-radius: 34px;
            }

            .slider.round:before {
            border-radius: 50%;
            }
        </style>
    </head>
    <body style="margin: 0 0; background-color: #c4e6f5;">
        <center>
            <br>
            <h1>Euclid Says</h1>
            <svg  data-bs-toggle="modal" data-bs-target="#exampleModal" xmlns="http://www.w3.org/2000/svg" onclick="modalText(-1)" viewBox="0 0 24 24" width="24" height="24" style="cursor: pointer; position: absolute; transform: translate(-100%, 0%); top: 3%; left: 97%;"><path d="M16 12a4 4 0 1 1-8 0 4 4 0 0 1 8 0Zm-1.5 0a2.5 2.5 0 1 0-5 0 2.5 2.5 0 0 0 5 0Z"></path><path d="M12 1c.266 0 .532.009.797.028.763.055 1.345.617 1.512 1.304l.352 1.45c.019.078.09.171.225.221.247.089.49.19.728.302.13.061.246.044.315.002l1.275-.776c.603-.368 1.411-.353 1.99.147.402.349.78.726 1.128 1.129.501.578.515 1.386.147 1.99l-.776 1.274c-.042.069-.058.185.002.315.112.238.213.481.303.728.048.135.142.205.22.225l1.45.352c.687.167 1.249.749 1.303 1.512.038.531.038 1.063 0 1.594-.054.763-.616 1.345-1.303 1.512l-1.45.352c-.078.019-.171.09-.221.225-.089.248-.19.491-.302.728-.061.13-.044.246-.002.315l.776 1.275c.368.603.353 1.411-.147 1.99-.349.402-.726.78-1.129 1.128-.578.501-1.386.515-1.99.147l-1.274-.776c-.069-.042-.185-.058-.314.002a8.606 8.606 0 0 1-.729.303c-.135.048-.205.142-.225.22l-.352 1.45c-.167.687-.749 1.249-1.512 1.303-.531.038-1.063.038-1.594 0-.763-.054-1.345-.616-1.512-1.303l-.352-1.45c-.019-.078-.09-.171-.225-.221a8.138 8.138 0 0 1-.728-.302c-.13-.061-.246-.044-.315-.002l-1.275.776c-.603.368-1.411.353-1.99-.147-.402-.349-.78-.726-1.128-1.129-.501-.578-.515-1.386-.147-1.99l.776-1.274c.042-.069.058-.185-.002-.314a8.606 8.606 0 0 1-.303-.729c-.048-.135-.142-.205-.22-.225l-1.45-.352c-.687-.167-1.249-.749-1.304-1.512a11.158 11.158 0 0 1 0-1.594c.055-.763.617-1.345 1.304-1.512l1.45-.352c.078-.019.171-.09.221-.225.089-.248.19-.491.302-.728.061-.13.044-.246.002-.315l-.776-1.275c-.368-.603-.353-1.411.147-1.99.349-.402.726-.78 1.129-1.128.578-.501 1.386-.515 1.99-.147l1.274.776c.069.042.185.058.315-.002.238-.112.481-.213.728-.303.135-.048.205-.142.225-.22l.352-1.45c.167-.687.749-1.249 1.512-1.304C11.466 1.01 11.732 1 12 1Zm-.69 1.525c-.055.004-.135.05-.161.161l-.353 1.45a1.832 1.832 0 0 1-1.172 1.277 7.147 7.147 0 0 0-.6.249 1.833 1.833 0 0 1-1.734-.074l-1.274-.776c-.098-.06-.186-.036-.228 0a9.774 9.774 0 0 0-.976.976c-.036.042-.06.131 0 .228l.776 1.274c.314.529.342 1.18.074 1.734a7.147 7.147 0 0 0-.249.6 1.831 1.831 0 0 1-1.278 1.173l-1.45.351c-.11.027-.156.107-.16.162a9.63 9.63 0 0 0 0 1.38c.004.055.05.135.161.161l1.45.353a1.832 1.832 0 0 1 1.277 1.172c.074.204.157.404.249.6.268.553.24 1.204-.074 1.733l-.776 1.275c-.06.098-.036.186 0 .228.301.348.628.675.976.976.042.036.131.06.228 0l1.274-.776a1.83 1.83 0 0 1 1.734-.075c.196.093.396.176.6.25a1.831 1.831 0 0 1 1.173 1.278l.351 1.45c.027.11.107.156.162.16a9.63 9.63 0 0 0 1.38 0c.055-.004.135-.05.161-.161l.353-1.45a1.834 1.834 0 0 1 1.172-1.278 6.82 6.82 0 0 0 .6-.248 1.831 1.831 0 0 1 1.733.074l1.275.776c.098.06.186.036.228 0 .348-.301.675-.628.976-.976.036-.042.06-.131 0-.228l-.776-1.275a1.834 1.834 0 0 1-.075-1.733c.093-.196.176-.396.25-.6a1.831 1.831 0 0 1 1.278-1.173l1.45-.351c.11-.027.156-.107.16-.162a9.63 9.63 0 0 0 0-1.38c-.004-.055-.05-.135-.161-.161l-1.45-.353c-.626-.152-1.08-.625-1.278-1.172a6.576 6.576 0 0 0-.248-.6 1.833 1.833 0 0 1 .074-1.734l.776-1.274c.06-.098.036-.186 0-.228a9.774 9.774 0 0 0-.976-.976c-.042-.036-.131-.06-.228 0l-1.275.776a1.831 1.831 0 0 1-1.733.074 6.88 6.88 0 0 0-.6-.249 1.835 1.835 0 0 1-1.173-1.278l-.351-1.45c-.027-.11-.107-.156-.162-.16a9.63 9.63 0 0 0-1.38 0Z"></path></svg>
            <br>
            <!-- Button trigger modal -->            
            <!-- Modal -->
            <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h4 class="modal-title" id="exampleModalLabel">Modal title</h5>
                      <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <p id="modal-text"></p>
                        <div id="setting" style="display: none;">
                            <h5>Toggle geometry terms</h5>
                            <h6>Easy Conditions</h6>
                            <label>Acute:</label><label class='switch'><input type='checkbox' class='toggle' data-term='acute' checked><span class='slider round'></span></label><br>
                            <label>Obtuse:</label><label class='switch'><input type='checkbox' class='toggle' data-term='obtuse' checked><span class='slider round'></span></label><br>
                            <label>Right:</label><label class='switch'><input type='checkbox' class='toggle' data-term='right' checked><span class='slider round'></span></label><br>
                            <hr>
                            <h6>Medium and Hard Conditions</h6>
                            <label>Congruent:</label><label class='switch'><input type='checkbox' class='toggle' data-term='congruent' checked><span class='slider round'></span></label><br>
                            <label>Complementary:</label><label class='switch'><input type='checkbox' class='toggle' data-term='complementary' checked><span class='slider round'></span></label><br>
                            <label>Supplementary:</label><label class='switch'><input type='checkbox' class='toggle' data-term='supplementary' checked><span class='slider round'></span></label><br>
                            <label>Adjacent:</label><label class='switch'><input type='checkbox' class='toggle' data-term='adjacent' checked><span class='slider round'></span></label>
                        </div>
                        <div id="explain" style="display:none;">
                            <nav>
                                <div class="nav nav-tabs" id="nav-tab" role="tablist">
                                <button class="nav-link active" id="nav-home-tab" data-bs-toggle="tab" data-bs-target="#nav-home" type="button" role="tab" aria-controls="nav-home" aria-selected="true">Introduction</button>
                                <button class="nav-link" id="nav-profile-tab" data-bs-toggle="tab" data-bs-target="#nav-profile" type="button" role="tab" aria-controls="nav-profile" aria-selected="false">Basics</button>
                                <button class="nav-link" id="nav-contact-tab" data-bs-toggle="tab" data-bs-target="#nav-contact" type="button" role="tab" aria-controls="nav-contact" aria-selected="false">Advanced</button>
                                </div>
                            </nav>
                            <div class="tab-content" id="nav-tabContent">
                                <div class="tab-pane fade show active" id="nav-home" role="tabpanel" aria-labelledby="nav-home-tab"><br>What is Geogebra? Geogebra is a powerful drawing tool that allows users to create amazing and detailed diagrams online.<br><br>While it takes a little while to get used to it, it is a great tool for learning geometry. This is a quick and easy tutorial to get started using Geogebra in Euclid Says. This game only uses a few functions, but feel free to use this canvas to explore different ones such as Area, Compass, and more!</div>
                                <div class="tab-pane fade" id="nav-profile" role="tabpanel" aria-labelledby="nav-profile-tab"><br>One quick note before you learn how to draw diagrams! If you want to save your diagram using the Save button, make sure you center it in the editor so that the image comes out nicely 😄.<br><br>The functions you'll need for this game are listed below:<br><br>
                                    <strong>Point</strong> - This tool allows you to create points as well as label them. Geogebra will automatically label your points starting from A although you can always change it as shown in this gif.
                                    <br>
                                    <br>
                                    <img src="Point Label.gif" width="100%">
                                    <br>
                                    <br>
                                    <strong>Line Segment</strong> - This tool is used to create line segments, which are the basis of angles. If you need to move the points of a line segment after you have created it, select "Move" and drag the points wherever you want.
                                    <br>
                                    <br>
                                    <img src="Line Segments.gif" width="100%">
                                    <br>
                                    <br>
                                    <strong>Angle</strong> - Obviously this tool is important as the entire game is based around angles. This tool isn't on the main menu, so you'll have to click "More" and scroll down to find it. When you have the tool selected, you can click wither 3 points or 2 line segments to create an angle. While most of the time you'll have one angle per point, sometimes you might have two different angles. In this case, you would need to label the angle itself to differentiate it from the other angle.
                                    <br>
                                    <br>
                                    <img src="Angle.gif" width="100%">
                                </div>
                                <div class="tab-pane fade" id="nav-contact" role="tabpanel" aria-labelledby="nav-contact-tab"><br>Here are some more advanced tools that will make drawing diagrams eaiser:
                                    <br>
                                    <br>
                                    <strong>Perpendicular Line</strong> - This tool will help you create right angles much eaiser than trying for a long time to ge the angle exact. It will save you much time and is definitely a useful skill to know.
                                    <br>
                                    <br>
                                    <img src="Perpendicular.gif" width="100%">
                                    <br>
                                    <br>
                                    <strong>Polygon</strong> - When creating multiple angles, this tool will be very useful. You can create a polygon by tapping the each vertex and then the starting point again. Now you can click the angle function on the entire polygon and all the angles will be labeled.
                                    <br>
                                    <br>
                                    <img src="Polygon.gif" width="100%">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                      <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    </div>
                  </div>
                </div>
              </div>
            <br>
            <p style="margin: 0% 10%; font-size: 20px;" id="Prompt">If possible draw a (plane) geometric figure and label two angles A and B...</p>
            <ul style="display: none;">
                <li></li>
                <li></li>
                <li></li>
            </ul>
            <br>
            <div id="ggb-element" style="width: 50%; height: 70%; display: inline-block;"></div>
            <svg data-bs-toggle="modal" data-bs-target="#exampleModal" style="transform: translate(0%, -25%); cursor: pointer; margin-left: 7px;" onclick="modalText(-2)" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path d="M13 7.5a1 1 0 1 1-2 0 1 1 0 0 1 2 0Zm-3 3.75a.75.75 0 0 1 .75-.75h1.5a.75.75 0 0 1 .75.75v4.25h.75a.75.75 0 0 1 0 1.5h-3a.75.75 0 0 1 0-1.5h.75V12h-.75a.75.75 0 0 1-.75-.75Z"></path><path d="M12 1c6.075 0 11 4.925 11 11s-4.925 11-11 11S1 18.075 1 12 5.925 1 12 1ZM2.5 12a9.5 9.5 0 0 0 9.5 9.5 9.5 9.5 0 0 0 9.5-9.5A9.5 9.5 0 0 0 12 2.5 9.5 9.5 0 0 0 2.5 12Z"></path></svg><br>
            <p id="problemNum"></p>
            <div style="display: flex; justify-content: center; align-items: center;">
                <div style="margin-right: 5px;">
                    <span>Difficulty: </span>
                    <button class="roll btn btn-success" onclick="roll1()">Easy!</button>
                    <button class="roll btn btn-warning" onclick="roll2()">Medium!</button>
                    <button class="roll btn btn-danger" onclick="roll3()">Hard!</button>
                </div>
                <div style="margin-left: 5px;">
                    <svg data-bs-toggle="modal" data-bs-target="#exampleModal" style="cursor: pointer;" onclick="modalText(0)" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path d="M13 7.5a1 1 0 1 1-2 0 1 1 0 0 1 2 0Zm-3 3.75a.75.75 0 0 1 .75-.75h1.5a.75.75 0 0 1 .75.75v4.25h.75a.75.75 0 0 1 0 1.5h-3a.75.75 0 0 1 0-1.5h.75V12h-.75a.75.75 0 0 1-.75-.75Z"></path><path d="M12 1c6.075 0 11 4.925 11 11s-4.925 11-11 11S1 18.075 1 12 5.925 1 12 1ZM2.5 12a9.5 9.5 0 0 0 9.5 9.5 9.5 9.5 0 0 0 9.5-9.5A9.5 9.5 0 0 0 12 2.5 9.5 9.5 0 0 0 2.5 12Z"></path></svg>
                </div>
            </div>
            <br>
            <div style="display: flex; justify-content: center; align-items: center;">
                <div style="margin-right: 5px;">
                    <input id="cb" type="checkbox" onclick="impossible()" style="transform: scale(1.2);">
                    <label onclick="impossible()" style="margin: 0 0;">Impossible</label>
                </div>
                <div style="margin-left: 5px;">
                    <svg data-bs-toggle="modal" data-bs-target="#exampleModal" style="cursor: pointer;" onclick="modalText(1)" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path d="M13 7.5a1 1 0 1 1-2 0 1 1 0 0 1 2 0Zm-3 3.75a.75.75 0 0 1 .75-.75h1.5a.75.75 0 0 1 .75.75v4.25h.75a.75.75 0 0 1 0 1.5h-3a.75.75 0 0 1 0-1.5h.75V12h-.75a.75.75 0 0 1-.75-.75Z"></path><path d="M12 1c6.075 0 11 4.925 11 11s-4.925 11-11 11S1 18.075 1 12 5.925 1 12 1ZM2.5 12a9.5 9.5 0 0 0 9.5 9.5 9.5 9.5 0 0 0 9.5-9.5A9.5 9.5 0 0 0 12 2.5 9.5 9.5 0 0 0 2.5 12Z"></path></svg>
                </div>
            </div><br>
            <p>Enter your reasoning:</p>
            <textarea id="text" style="width: 25%; height: 10%; font-size: 15px;"></textarea><br>
            <br>
            <button onclick="submit()" id="sub" style="filter: brightness(75%); color: white;" class="btn btn-info" disabled>Submit!</button>
            <p id="response"></p>
            <button onclick="save()" id="save" style="filter: brightness(75%); color: white" class="btn btn-info" disabled>Save!</button><br><br>
            <br>
            <div style="display: flex; justify-content: center; align-items: center;">
                <div style="margin-right: 5px;">
                    <span id="assigntxt"></span><input id="assign" type="number" min="1">
                </div>
                <div style="margin-left: 5px;">
                    <svg data-bs-toggle="modal" data-bs-target="#exampleModal" style="cursor: pointer;" onclick="modalText(2)" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path d="M13 7.5a1 1 0 1 1-2 0 1 1 0 0 1 2 0Zm-3 3.75a.75.75 0 0 1 .75-.75h1.5a.75.75 0 0 1 .75.75v4.25h.75a.75.75 0 0 1 0 1.5h-3a.75.75 0 0 1 0-1.5h.75V12h-.75a.75.75 0 0 1-.75-.75Z"></path><path d="M12 1c6.075 0 11 4.925 11 11s-4.925 11-11 11S1 18.075 1 12 5.925 1 12 1ZM2.5 12a9.5 9.5 0 0 0 9.5 9.5 9.5 9.5 0 0 0 9.5-9.5A9.5 9.5 0 0 0 12 2.5 9.5 9.5 0 0 0 2.5 12Z"></path></svg>
                </div>
            </div>
            <br><button id="assignBtn"  class="btn btn-primary" onclick="assign()">Try it!</button>
            <br><br>
            <br>
            <br>
            <canvas id="SaveDiagram" style="display: none;" width="750" height="750" style="border: 2px black solid;">
            </canvas>
        </center>
        <script>
            var params = {"appName": "geometry", "width": 800, "height": 600, "showToolBar": true, "showAlgebraInput": true, "showMenuBar": true};
            var applet = new GGBApplet(params, true);
            applet.inject('ggb-element');
            var cv = document.getElementById("SaveDiagram");
            var ctx = cv.getContext('2d');
            var prompt = document.getElementById("Prompt");
            var sub = document.getElementById("sub");
            var response = document.getElementById("response");
            var card1 = ["one of which is acute and the other of which is right, ", "one of which is acute and the other of which is obtuse, ","one of which is right and the other of which is obtuse, ","both of which are acute, ","both of which are obtuse, "];
            var card2 = ["angle A and angle B are complementary","angle A and angle B are congruent","angle A and angle B are adjacent","angle A and angle B are not complementary","angle A and angle B are supplementary","angle A and angle B are not supplementary","angle A and angle B are congruent and complementary","angle A and angle B are complementary and not congruent","angle A and angle B are supplementary and not congruent","angle A and angle B are adjacent and congruent","angle A and angle B are adjacent and complementary","angle A and angle B are adjacent and supplementary"];
            var card3 = ["the figure contains another angle, C, which is congruent to angle A.","the figure contains another angle, C, which is not congruent to angle A.","the figure contains another angle, C, which is congruent to angle B.","the figure contains another angle, C, which is not congruent to angle B.","the figure contains another angle, C, which is supplementary to angle A.","the figure contains another angle, C, which is not supplementary to angle A.","the figure contains another angle, C, which is supplementary to angle B.","the figure contains another angle, C, which is not supplementary to angle B.","the figure contains another angle, C, which is complementary to angle A.","the figure contains another angle, C, which is not complementary to angle A.","the figure contains another angle, C, which is complementary to angle B.","the figure contains another angle, C, which is not complementary to angle B.","the figure contains another angle, C, which is adjacent to angle A.","the figure contains another angle, C, which is not adjacent to angle A.","the figure contains another angle, C, which is adjacent to angle B.","the figure contains another angle, C, which is not adjacent to angle B."];
            var cards = ["", "", ""];
            var dict1 = ["both", "acute", "right", "obtuse"];
            var dict2 = ["and", "complementary", "congruent", "", "adjacent", "supplementary"];
            var checkbox = document.getElementById("cb");
            var number = document.getElementById("assign");
            var assignBtn = document.getElementById("assignBtn");
            var problemID = -1;
            var problemNum = document.getElementById("problemNum");
            var saveBtn = document.getElementById("save");
            var textArea = document.getElementById("text");

            document.getElementById("assigntxt").innerHTML = "Enter Problem ID (1 - " + (card1.length*card2.length*card3.length + card1.length*card2.length + card1.length) + "): ";
            number.max = card1.length*card2.length*card3.length + card1.length*card2.length + card1.length;

            function modalText(index) {
                if (index === -1) {
                    document.getElementById("modal-text").style.display = "none";
                    document.getElementById("explain").style.display = "none";
                    document.getElementById("exampleModalLabel").innerHTML = "Settings";
                    document.getElementById("setting").style.display = "block";
                    return;
                }
                if (index === -2) {
                    document.getElementById("modal-text").style.display = "none";
                    document.getElementById("setting").style.display = "none";
                    document.getElementById("exampleModalLabel").innerHTML = "Geogebra Geometry Tool";
                    document.getElementById("explain").style.display = "block";
                    return;
                }
                document.getElementById("setting").style.display = "none";
                document.getElementById("explain").style.display = "none";
                document.getElementById("modal-text").style.display = "block";
                var title = ["Difficulty Buttons", "\"Impossible\" Checkmark", "Problem ID's and Choosing Problems"];
                var txt = ["This difficulty represents the number of conditions that Euclid gives when you press the button. Easy gives one, medium gives two, and hard gives three.",
                            "Since Euclid's challenges are random, the combination of conditions might result in an impossible task. If this happens click this checkmark to signal that it is impossible",
                            "If you are playing in a group, a friend might recommend a specific problem. If they give you a problem ID, you can enter it here to play the same problem."];
                document.getElementById("exampleModalLabel").innerHTML = title[index];
                document.getElementById("modal-text").innerHTML = txt[index];
            }
            function save() {
                
                var url = ggbApplet.getPNGBase64(1, true, undefined);
                // Get the image data as a base64-encoded string
                canvas = new Image();
                canvas.onload = cont;
                canvas.src = "data:image/png;base64, " + url;
                function cont() {
                    ctx.font = "30px Arial";
                    ctx.textAlign = "center";
                    var lines = fragmentText(prompt.innerHTML.replace("<br>", " "), 750 - parseInt(30,0));
                    lines.forEach(function(line, i) {
                        ctx.fillText(line, 750 / 2, (i + 1) * parseInt(30,0));
                    });

                    ctx.font = "24px Arial";
                    var lines = fragmentText(textArea.value, 750 - parseInt(24,0));
                    lines.forEach(function(line, i) {
                        ctx.fillText(line, 750 / 2, (i + 27) * parseInt(24,0));
                    });
                    ctx.fillText("Explanation:", 750 / 2, 26 * parseInt(24,0));

                    if (checkbox.checked) {
                        ctx.font = "40px Arial";
                        ctx.fillText("IMPOSSIBLE", 375, 375);
                    }
                    else {
                        ctx.drawImage(canvas, 375 - canvas.width/2, 375 - canvas.height/2);
                    }
                    ctx.fillStyle = "#fff";
                    ctx.globalCompositeOperation = 'destination-over'
                    ctx.fillRect(0,0,cv.width,cv.height);

                    ctx.drawImage(canvas, 375 - canvas.width/2, 375 - canvas.height/2);
                    const imageData = cv.toDataURL("image/png");
                    // Do something with the image data, such as saving it as a file or sending it to a server
                    // For example, you can create an anchor element and trigger a download action
                    const link = document.createElement("a");
                    link.setAttribute("download", "Problem " + (problemID + 1) + " Solution.png");
                    link.setAttribute("href", imageData);
                    link.click();

                    ctx.clearRect(0, 0,cv.width, cv.height);
                    ctx.fillStyle = "#000";
                    ctx.globalCompositeOperation = 'source-over';
                    saveBtn.disabled = true;
                    saveBtn.style.filter = "brightness(75%)";
                }

            }
            function fragmentText(text, maxWidth) {
                var words = text.split(' '),
                    lines = [],
                    line = "";
                if (ctx.measureText(text).width < maxWidth) {
                    return [text];
                }
                while (words.length > 0) {
                    while (ctx.measureText(words[0]).width >= maxWidth) {
                        var tmp = words[0];
                        words[0] = tmp.slice(0, -1);
                        if (words.length > 1) {
                            words[1] = tmp.slice(-1) + words[1];
                        } else {
                            words.push(tmp.slice(-1));
                        }
                    }
                    if (ctx.measureText(line + words[0]).width < maxWidth) {
                        line += words.shift() + " ";
                    } else {
                        lines.push(line);
                        line = "";
                    }
                    if (words.length === 0) {
                        lines.push(line);
                    }
                }
                return lines;
            }
            function assign() {
                if (number.value === "") {
                    problemNum.innerHTML = "Enter a number between 1 - " + (card1.length*card2.length*card3.length + card1.length*card2.length + card1.length) + ".";
                    return;
                }
                response.innerHTML = ""; 
                problemID = parseInt(number.value - 1);
                if (problemID < 0 || problemID >= card1.length*card2.length*card3.length + card1.length*card2.length + card1.length) {
                    problemNum.innerHTML = "Enter a number between 1 - " + (card1.length*card2.length*card3.length + card1.length*card2.length + card1.length) + ".";
                    return;
                }
                if (problemID < card1.length) {
                    var s1 = card1[problemID];
                    cards[0] = s1;
                    prompt.innerHTML = "If possible draw a (plane) geometric figure and label two angles A and B " + s1.substring(0,s1.length-2) + ".";
                }
                else if (problemID < card1.length + card1.length*card2.length) {
                    var s1 = card1[Math.floor((problemID - card1.length)/card2.length)];
                    var s2 = card2[(problemID - card1.length)%card2.length];
                    cards[0] = s1;
                    cards[1] = s2;
                    prompt.innerHTML = "If possible draw a (plane) geometric figure and label two angles A and B " + s1+ "such that " + s2 + ".";
                }
                else {
                    var s1 = card1[Math.floor((problemID - card1.length*card2.length-card1.length)/(card2.length*card3.length))];
                    var s2 = card2[Math.floor((problemID - card1.length*card2.length-card1.length)/card3.length)%card2.length];
                    var s3 = card3[(problemID - card1.length*card2.length-card1.length)%card3.length];
                    cards[0] = s1;
                    cards[1] = s2;
                    cards[2] = s3;
                    prompt.innerHTML = "If possible draw a (plane) geometric figure and label two angles A and B " + s1 + " such that " + s2 + " and such that " + s3;
                }
                sub.disabled = false;
                sub.style.filter = "brightness(100%)";
                checkbox.checked = false;
                impossible();
                $(".roll").prop("disabled", true);
                assignBtn.disabled = true;
                problemNum.innerHTML = "Problem ID: " + (problemID + 1);
            }
            function impossible() {
                var iframe = document.getElementById("ggb-element");
                if (checkbox.checked) {
                    iframe.style.filter = "brightness(50%)";
                    iframe.style.pointerEvents = "none";
                }
                else {
                    iframe.style.filter = "brightness(100%)";
                    iframe.style.pointerEvents = "auto";
                }
            }
            function check1(angles, points) {
                var both = false;
                var success1 = "";
                var overall_success = false;
                var a = angles[points.indexOf("A")];
                var b = angles[points.indexOf("B")];
                var funcs = [null, function(angle) {return angle < 90}, function(angle) {return angle === 90}, function(angle) {return angle > 90}];
                
                for (var k = 0; k < dict1.length; k++) {
                    if (cards[0].indexOf(dict1[k]) != -1) {
                        if (k === 0) {
                            both = true;
                        }
                        else {
                            if (both) {
                                if (funcs[k](a) && funcs[k](b)) {
                                    success1 = "AB";
                                    break;
                                }
                            } 
                            else {
                                if (success1 === "") {
                                    if (funcs[k](a)) {
                                        success1 = "B";
                                    }
                                    else if (funcs[k](b)) {
                                        success1 = "A";
                                    }
                                }
                                else {
                                    if (funcs[k](angles[points.indexOf(success1)])) {
                                        success1 = "AB";
                                        break;
                                    }
                                }
                            }
                        }
                    }    
                }
                if (success1 === "AB") {
                    overall_success = true;
                }
                return overall_success;
            }
            function roll1() {
                response.innerHTML = "";
                var restrictions = document.querySelectorAll(".toggle:not(:checked)");
                var new_cards = [card1];
                for (var i = 0; i < new_cards.length; i++) {
                    for (var j = 0; j < restrictions.length; j++) {
                        new_cards[i] = new_cards[i].filter(function(item) {
                            return item.indexOf(restrictions[j].dataset.term) === -1;
                        })
                    }
                }
                for (var l = 0; l < new_cards.length; l++) {
                    if (new_cards[l].length === 0) {
                        prompt.innerHTML = "The current settings give no possible outputs. Please change them to play the game.";
                        return;
                    }
                }
                var s1 = new_cards[0][Math.floor(Math.random()*new_cards[0].length)];
                problemID = card1.indexOf(s1);
                cards[0] = s1;
                prompt.innerHTML = "If possible draw a (plane) geometric figure and label two angles A and B " + s1.substring(0,s1.length-2) + ".";
                sub.disabled = false;
                sub.style.filter = "brightness(100%)";
                checkbox.checked = false;
                impossible();
                $(".roll").prop("disabled", true);
                problemNum.innerHTML = "Problem ID: " + (problemID + 1);
                assignBtn.disabled = true;
                saveBtn.disabled = true;
                saveBtn.style.filter = "brightness(75%)";
            }
            function roll2() {
                response.innerHTML = "";
                var restrictions = document.querySelectorAll(".toggle:not(:checked)");
                var new_cards = [card1, card2];
                for (var i = 0; i < new_cards.length; i++) {
                    for (var j = 0; j < restrictions.length; j++) {
                        new_cards[i] = new_cards[i].filter(function(item) {
                            return item.indexOf(restrictions[j].dataset.term) === -1;
                        })
                    }
                }
                for (var l = 0; l < new_cards.length; l++) {
                    if (new_cards[l].length === 0) {
                        prompt.innerHTML = "The current settings give no possible outputs. Please change them to play the game.";
                        return;
                    }
                }
                var s1 = new_cards[0][Math.floor(Math.random()*new_cards[0].length)];
                var s2 = new_cards[1][Math.floor(Math.random()*new_cards[1].length)];
                cards[0] = s1;
                cards[1] = s2;
                problemID = card1.length + card1.indexOf(s1)*card2.length + card2.indexOf(s2);
                prompt.innerHTML = "If possible draw a (plane) geometric figure and label two angles A and B " + s1 + " such that " + s2 + ".";
                sub.disabled = false;
                sub.style.filter = "brightness(100%)";
                checkbox.checked = false;
                impossible();
                $(".roll").prop("disabled", true);
                problemNum.innerHTML = "Problem ID: " + (problemID + 1);
                assignBtn.disabled = true;
                saveBtn.disabled = true;
                saveBtn.style.filter = "brightness(75%)";
            }
            function roll3() {
                response.innerHTML = "";
                var restrictions = document.querySelectorAll(".toggle:not(:checked)");
                var new_cards = [card1, card2, card3];
                for (var i = 0; i < new_cards.length; i++) {
                    for (var j = 0; j < restrictions.length; j++) {
                        new_cards[i] = new_cards[i].filter(function(item) {
                            return item.indexOf(restrictions[j].dataset.term) === -1;
                        })
                    }
                }
                for (var l = 0; l < new_cards.length; l++) {
                    if (new_cards[l].length === 0) {
                        prompt.innerHTML = "The current settings give no possible outputs. Please change them to play the game.";
                        return;
                    }
                }
                var s1 = new_cards[0][Math.floor(Math.random()*new_cards[0].length)];
                var s2 = new_cards[1][Math.floor(Math.random()*new_cards[1].length)];
                var s3 = new_cards[2][Math.floor(Math.random()*new_cards[2].length)];
                cards[0] = s1;
                cards[1] = s2;
                problemID = card1.length + card1.length*card2.length + card1.indexOf(s1)*card2.length*card3.length + card2.indexOf(s2)*card3.length + card3.indexOf(s3);
                cards[2] = s3;
                prompt.innerHTML = "If possible draw a (plane) geometric figure and label two angles A and B " + s1 + " such that " + s2 + " and such that " + s3;
                sub.disabled = false;
                sub.style.filter = "brightness(100%)";
                checkbox.checked = false;
                impossible();
                $(".roll").prop("disabled", true);
                problemNum.innerHTML = "Problem ID: " + (problemID + 1);
                assignBtn.disabled = true;
                saveBtn.disabled = true;
                saveBtn.style.filter = "brightness(75%)";
            }
            function submit() {
                if (textArea.value === "" && !confirm("It looks like the Explanation box is blank. Would you still like to submit?")) {
                    return;
                }
                names = ggbApplet.getAllObjectNames(["angle"]);
                captions = [];
                values = [];
                for (var i = 0; i < names.length; i++) {
                    captions.push(ggbApplet.getCaption(names[i], true));
                    values.push(Math.round(ggbApplet.getValue(names[i])*1800/(Math.PI))/10);
                }
                var ABCexists = "A B C";
                for (var i = 0; i < captions.length; i++) {
                    if (ABCexists.includes(captions[i])) {
                        ABCexists.replace(captions[i], "");
                    }
                }
                for (var j = 0; j < names.length; j++) {
                    var cmdString = ggbApplet.getCommandString(names[j]).split(", ");
                    var angle = cmdString[1];
                    if (cmdString[0].includes("InteriorAngle")) {
                        angle = ggbApplet.getCommandString(cmdString[0].split(/[()]/)[1]).split(/[()]/)[1].split(", ")[j+1];
                    }
                    if (ABCexists.includes(angle)) {
                        ABCexists = ABCexists.replace(angle, "");
                        captions[j] = angle;
                    }
                }
                if ((ABCexists === "  C" && cards[2] !== "") && ABCexists !== "  ") {
                    response.innerHTML = "<br>Diagram is missing angle(s) " + ((cards[2] === "") ? ABCexists.replace("C", "") : ABCexists) + ".";
                    return;
                }
                /* if (cards[1] === "") {
                    if (check1(values, captions)) {
                        response.innerHTML = "<br>Great job!";
                    }
                    else {
                        response.innerHTML = "<br>Oops! That's not correct. Try again!";
                        saveBtn.disabled = false;
                        saveBtn.style.filter = "brightness(100%)";
                        return;
                    }
                }
                else { */
                response.innerHTML = "<br>Autograding coming soon! For now, save your work below to check if it is correct later!";
                // }

                cards = ["", "", ""];
                $(".roll").prop("disabled", false);
                assignBtn.disabled = false;
                saveBtn.disabled = false;
                saveBtn.style.filter = "brightness(100%)";
                sub.disabled = true;
                sub.style.filter = "brightness(75%)";
            }
        </script>
    </body>
</html>